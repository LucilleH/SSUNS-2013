{% extends "base.html" %}

{% block content %}
<h1>Your dashboard</h1>

{% if unfilled_assignments %}
<div class="alert">
    <p>You have unfilled committee assignments! Please indicate the names of the delegates who will be occupying each country or character assignment in the <a href="#committee-assignments"><strong>Committee assignments</strong></a> section below, needed for badge-printing purposes.</p>
</div>
{% endif %}

{% if school %}
<table id="dashboard-table">
	<tr>
		<td>
			<div id="profile">
				<h3>{{ school }}</h3>

				<p>
					{{ school.first_name }} {{ school.last_name }}
					<br />
					{{ school.address }}
					<br />
					{{ school.get_country_display }}
					<br />
					{{ school.phone_number }}
				</p>
				<br />
				<p>
					<strong>Email address:</strong> {{ user.username }}
					<br />
					<a href="{% url password %}">Change your password</a> :: <a href="{% url logout %}">Log out</a>
				</p>
			</div>
		</td>
		<td>
			<div id="invoice">
				<h2>Invoice details</h2>
				<p>
					<strong>Number of delegates:</strong> {{ school.num_delegates }}
					<br />
					<strong>Payment method:</strong> {% if school.use_online_payment %}online payment{% else %}by cheque{% endif %}
					<br />
					<strong>Priority registration:</strong> {% if school.use_priority %}Yes{% else %}No{% endif %}
					<br />
					<strong>Amount owed:</strong> {{ school.amount_owed }} {{ school.get_currency }}
					<br />
					<strong>Amount paid:</strong> ${{ school.amount_paid }} {{ school.get_currency }}
				</p>
				<p>Lost your copy of your invoice PDF? Email it@ssuns.org.{% comment %}Eventually I'll make a view to show the PDF to people with the proper permissions. Later.{% endcomment %}</p>
			</div>
		</td>
	</tr>
</table>

{% if school.committeeassignment_set.count %}
<h2 id="committee-assignments">Committee assignments</h2>
<p>Please ensure that you enter a delegate's name for each position that you have been assigned, by January 12. Once you have filled in the delegate name(s) for each position, make sure to upload the relevant position paper, by January 23.</p>
<p>Please check that any delegate names that have been entered are entered correctly, as you will not be able to change anything once submitted except by contacting <a href="mailto:charge@mcmun.org">charge@mcmun.org</a>. You do not have to enter all the names at once.</p>
<form action="{% url assignments %}" method="post" enctype="multipart/form-data">
{% for m in management_forms %}{{ m }}{% endfor %}
{% csrf_token %}
<table class="separated-cells">
	<thead>
		<tr>
			<th>Committee</th>
			<th>Assignment</th>
			<th>Delegate name(s)</th>
			<th>Position paper</th>
			<th>Scholarship application</th>
		</tr>
	</thead>
	<tbody>
		{% for f, s_f in formset %}
		{% with c=f.instance s=s_f.instance %}
		<tr>
			<td><a href="{{ c.committee.get_absolute_url }}">{{ c.committee.get_name }}</a></td>
			<td>{{ c.get_assignment_display }}</td>
			<td>
				{% if c.delegate_name %}
					<p>Delegate name: {{ c.delegate_name }}</p>
					<div class="hidden">{{ f.delegate_name }}</div>
				{% else %}
					{{ f.delegate_name }}
				{% endif %}
			</td>
			<td>
            	{{ f.id }}
                {% if c.delegate_name %}
                   	{{ f.position_paper }}
                {% else %}
                    Uploading position paper after submitting the delegate name.
                {% endif %}
            </td>
			<td>
				{{ f.id }}
				{% if c.delegate_name %}
					{% for s in s_f %}
						{{ s.scholarship_individual }}
					{% endfor %}
				{% else %}
					Apply individual scholarship after submitting the delegate name.
				{% endif %}
			</td>
		</tr>
		{% endwith %}
		{% endfor %}
	</tbody>
</table>

<p><strong>Please confirm any names that you've filled in before pressing submit. If you leave a field blank, you may fill it in later.</strong></p>

<fieldset class="submit">
	<input type="submit" name="submit" value="Submit" />
</fieldset>
</form>
{% endif %}

<h2 id="dates">Important dates</h2>

<table>
   	<tr><td><b>July 30:</b> Priority Registration Deadline (All Payments Made to be Eligible for Priority Fees)</td></tr>
	<tr><td><b>First Week of September:</b> Background Guides come online</td></tr>
	<tr><td><b>First Week of September:</b> Initial Committee Assignments Released</td></tr>
	<tr><td><b>September 10:</b> Deadline for 100% Refund of Delegate Fees</td></tr>
	<tr><td><b>September 17:</b> Scholarship Applications Deadline</td></tr>
	<tr><td><b>October 1:</b> Deadline for 50% Refund of Delegate Fees</td></tr>
	<tr><td><b>October 8:</b> Regular Registration Closes and Waiting List Opens</td></tr>
	<tr><td><b>October 8:</b> Hotel Room Bookings at Delta Centreville Due</td></tr>
	<tr><td><b>October 25:</b> Position Paper Feedback Deadline</td></tr>
	<tr><td><b>October 29:</b> Delegate Badge List Due</td></tr>
	<tr><td><b>November 6:</b> Final Position Paper Deadline</td></tr>
	<tr><td><b>November 7-10:</b> SSUNS 2013</td></tr>
</table>

<h2 id="committees">Committee preferences</h2>

<p>The committee preferences form is now <strong>closed</strong>.</p>

<p>You have indicated your committee preferences to be:</p>

<table>
	<tr><td>{{ school.committee_1.get_name }}</td></tr>
	<tr><td>{{ school.committee_2.get_name }}</td></tr>
	<tr><td>{{ school.committee_3.get_name }}</td></tr>
	<tr><td>{{ school.committee_4.get_name }}</td></tr>
</table>

<p>Please contact <a href="mailto:schools@ssuns.org">schools@ssuns.org</a> if you have any questions or wish to change your preferences.</p>

<h2 id="committees">Country Preferences</h2>
<table>
   	<tr><td>{{ school.get_country_1_display }}</td>
	    <td>{{ school.get_country_2_display }}</td></tr>
	<tr><td>{{ school.get_country_3_display }}</td>
	    <td>{{ school.get_country_4_display }}</td></tr>
	<tr><td>{{ school.get_country_5_display }}</td>
	    <td>{{ school.get_country_6_display }}</td></tr>
	<tr><td>{{ school.get_country_7_display }}</td>
	    <td>{{ school.get_country_8_display }}</td></tr>
	<tr><td>{{ school.get_country_9_display }}</td>
	    <td>{{ school.get_country_10_display }}</td>
   </tr>
</table>

{% comment %}
<div id="scholarship">
	<h2>Scholarship application</h2>
	{% if form %}
		{% include 'scholarship_form.html' %}
	{% else %}
		<p>Thank you for completing the scholarship application. You will receive information regarding the status of your scholarship by December 1<sup>st</sup>. If you have any questions or wish to change or add information to your application, please do not hesitate to contact our Chargé D’Affaires, Daniel Stysis at charge@mcmun.org.</p>
		<p><em>It is required that all scholarship recipients stay at the Sheraton during the conference.</em></p>
	{% endif %}
</div>
{% endcomment %}
{% else %}
<p>Unfortunately there's nothing for you to see here. Please move along.</p>
{% endif %}

{% endblock %}
